# バドミントンゲーム練習管理システム 画面設計書

## 1. 画面一覧

| 画面ID | 画面名 | 概要 |
|--------|--------|------|
| S01 | セッション作成・初期設定画面 | 管理者用：新しいセッションを作成し初期設定を行う |
| S02 | 参加者選択画面 | 参加者が自分の名前を選択する画面 |
| S03 | メイン画面 | コート状況、待機者、試合ログを管理する中心画面 |
| S04 | スコア入力画面 | 試合結果を入力する画面 |
| S05 | 設定画面 | アプリ全体の設定を行う画面 |
| S07 | 参加者管理画面 | 当日の参加者を初期設定する画面（管理用） |

---

## 2. 画面遷移図

```
【管理者用URL】
/session/create
    ↓
[S01 セッション作成・初期設定]
    ↓
セッションID生成 → 参加者用URL発行
    ↓
[S03 メイン画面]


【参加者用URL】
/session/{sessionId}
    ↓
[S02 参加者選択]
    ↓
[S03 メイン画面] ←→ [S04 スコア入力]
    ↓
[S05 設定] ←→ [S07 参加者管理]
```

### 遷移パターン詳細

| 遷移元 | 遷移先 | トリガー | 備考 |
|--------|--------|----------|------|
| - | S01 | 管理者用URLアクセス | /session/create |
| S01 | S03 | 「次へ」ボタン | セッションID生成、参加者用URL表示 |
| - | S02 | 参加者用URLアクセス | /session/{sessionId} |
| S02 | S03 | 名前選択完了 | 参加者の入室 |
| S03 | S04 | 試合ログの「入力」「修正」ボタン | スコア入力・修正 |
| S04 | S03 | 「確定」ボタン | スコア記録完了 |
| S03 | S05 | 「設定」アイコン（歯車） | ナビゲーションバー |
| S05 | S07 | 「参加者を管理」ボタン | 参加者リスト編集 |
| S05 | S03 | 「完了」ボタン | 設定終了 |
| S07 | S05 | 「完了」ボタン | 参加者管理終了 |
| S05 | S03 | 「練習をリセット」実行後 | データリセット完了 |

---

## 3. 画面詳細設計

### S01: セッション作成・初期設定画面

#### 目的
管理者が新しいセッションを作成し、初期設定を行う

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S01-01 | ラベル | タイトル | "バドミントンゲーム練習管理" |
| S01-02 | ラベル | 説明文 | "新しい練習セッションを作成" |
| S01-03 | テキストフィールド | スプレッドシートURL | GoogleスプレッドシートのURL入力欄（任意） |
| S01-04 | ラベル | URL説明 | "※空欄の場合、レーティングは未設定になります" |
| S01-05 | セグメントコントロール | 点数設定 | "21点" / "15点" / "フリー" |
| S01-06 | ラベル | 当日参加者見出し | "当日の参加者" |
| S01-07 | テキストビュー | 参加者入力欄 | 改行・カンマ区切りで入力 |
| S01-08 | ラベル | 参加者ヒント | "改行またはカンマ区切り" |
| S01-09 | ラベル | セッションID見出し | "参加者用URL" |
| S01-10 | ラベル | URL表示 | 参加者用URLをテキスト表示（セッションID生成後に表示） |
| S01-11 | ボタン | URL共有ボタン | "URLを共有" ボタン（LINE、コピーなど） |
| S01-12 | ボタン | 次へ | 設定完了ボタン |

#### 画面レイアウト
```
┌─────────────────────────┐
│  バドミントンゲーム練習管理  │
│                         │
│ まず基本設定を行いましょう │
│                         │
│ ┌─────────────────────┐ │
│ │ スプレッドシートURL    │ │
│ │ [入力欄____________] │ │
│ │ ※空欄の場合、レーティング│ │
│ │   は未設定になります   │ │
│ └─────────────────────┘ │
│                         │
│ 点数設定:               │
│ [ 21点 | 15点 | フリー ] │
│                         │
│ 当日の参加者:           │
│ ┌─────────────────────┐ │
│ │ たかし              │ │
│ │ ゆうこ              │ │
│ │ けんた              │ │
│ │                     │ │
│ └─────────────────────┘ │
│ (改行またはカンマ区切り)  │
│                         │
│ 参加者用URL:            │
│ ┌─────────────────────┐ │
│ │ app.com/session/ABC123│ │
│ │   [URLを共有]        │ │
│ └─────────────────────┘ │
│                         │
│      ┌─────────┐        │
│      │   次へ   │        │
│      └─────────┘        │
└─────────────────────────┘
```

---

### S02: 参加者選択画面

#### 目的
参加者が自分の名前（ニックネーム）を選択して入室

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S02-01 | ラベル | タイトル | "あなたの名前を選択してください" |
| S02-02 | リスト | 参加者リスト | ニックネーム一覧（スクロール可能、選択済みはグレーアウト） |
| S02-03 | ボタン | 名前追加ボタン | "+ 名前を追加" |
| S02-04 | アラート | 名前追加ダイアログ | 新しい名前を入力 |
| S02-05 | アラート | 重複エラー | 同じ名前は登録不可 |

**注記**: 
- 他の参加者が選択完了してS03に遷移した名前はグレーアウト表示（選択不可）
- 同じ名前の重複登録は禁止（エラー表示）

#### 画面レイアウト
```
┌─────────────────────────┐
│ あなたの名前を選択してください│
│                         │
│ ┌─────────────────────┐ │
│ │ □ たかし             │ │
│ │ ■ ゆうこ (選択済み)  │ │ ← グレーアウト
│ │ □ けんた             │ │
│ │ □ まい               │ │
│ │ ...                  │ │
│ │                      │ │
│ └─────────────────────┘ │
│                         │
│   ┌───────────────┐    │
│   │ + 名前を追加   │    │
│   └───────────────┘    │
└─────────────────────────┘
```

---

### S03: メイン画面（最重要）

#### 目的
コート状況、待機者、休憩者、試合ログを一覧表示し、ゲーム進行を管理

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S03-01 | ナビゲーションバー | タイトル | "ゲーム進行中" |
| S03-02 | ボタン | 設定アイコン | 歯車アイコン（右上） |
| S03-03 | セクション | コート状況 | 各コートの試合状況を表示 |
| S03-04 | ボタン | コート数減少ボタン | "−" ボタン（コート状況見出し横、最小1） |
| S03-05 | ボタン | コート数増加ボタン | "+" ボタン（コート状況見出し横、最大3） |
| S03-06 | カード | コートカード（複数） | 1〜3コート分のカード（動的に表示） |
| S03-07 | ボタン | 配置ボタン | 各コートカード下部に配置 |
| S03-08 | セクション | 待機メンバー | 待機中のメンバー一覧 |
| S03-09 | リスト | 待機者リスト | スクロール可能なリスト（試合数昇順でソート） |
| S03-10 | セクション | 休憩メンバー | 休憩中のメンバー一覧 |
| S03-11 | リスト | 休憩者リスト | スクロール可能なリスト |
| S03-12 | セクション | 試合ログ | 試合結果の履歴（最大100件） |
| S03-13 | ボタン | ログ表示切替 | "▼" または "▲" トグルボタン |
| S03-14 | リスト | ログリスト | スクロール可能な試合結果一覧 |
| S03-15 | タブバー | タブバー | メイン / 設定 |

#### コートカード詳細要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S03-C01 | ラベル | コート番号 | "コート 1" など |
| S03-C02 | ラベル | ペアA名前1 | ニックネーム表示（タップで選択可能） |
| S03-C03 | ラベル | ペアA名前2 | ニックネーム表示（タップで選択可能） |
| S03-C04 | ラベル | VS表示 | "vs" |
| S03-C05 | ラベル | ペアB名前1 | ニックネーム表示（タップで選択可能） |
| S03-C06 | ラベル | ペアB名前2 | ニックネーム表示（タップで選択可能） |
| S03-C07 | オーバーレイ | ゲーム中表示 | 半透明の覆い + "ゲーム中" テキスト |
| S03-C08 | ボタン | 配置ボタン | "配置" ボタン（空き時のみ表示） |
| S03-C09 | ボタン | クリアボタン | "クリア" ボタン（4人配置済み・開始前のみ表示） |
| S03-C10 | ボタン | 開始ボタン | "開始" ボタン（4人配置済み・開始前のみ表示、配置なしは無効化） |
| S03-C11 | ボタン | 終了ボタン | "終了" ボタン（ゲーム中のみ表示） |
| S03-C12 | 状態 | 選択状態 | 選択中は背景色変更（青など） |
| S03-C13 | 状態 | ゲーム状態 | 空き / 配置済み / ゲーム中 の3状態 |

**状態遷移**:
- **空き**: 配置ボタンのみ表示
- **配置済み（開始前）**: クリアボタン + 開始ボタン表示
- **ゲーム中**: 半透明オーバーレイ + "ゲーム中" + 終了ボタン表示

#### 待機者リスト項目要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S03-W01 | ラベル | ニックネーム | 待機者の名前（タップで選択可能） |
| S03-W02 | ラベル | 試合数 | "(3)" のように括弧付きで表示 |
| S03-W03 | アイコン | スコア未入力表示 | "📝未" アイコン（自分参加の試合でスコア未入力時のみ表示） |
| S03-W04 | ボタン | 休憩ボタン | "休憩" トグルボタン |
| S03-W05 | 状態 | 選択状態 | 選択中は背景色変更（青など） |

**注記**: 
- レーティングは裏で保持するが、画面上には一切表示しない（心理的安全性のため）
- スコア未入力者は配置時の優先度が下がる
- 試合数が少ない人は配置時の優先度が上がる
- **表示順**: 試合数の昇順（少ない順）で表示、同数の場合は入室順など

#### 休憩者リスト項目要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S03-R01 | ラベル | ニックネーム | 休憩者の名前 |
| S03-R02 | ボタン | 復帰ボタン | "復帰" ボタン |

#### 試合ログリスト項目要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S03-L01 | ラベル | 連番 | 試合の通し番号（新しい順） |
| S03-L02 | ラベル | プレイヤー | 4人のニックネーム（ペアA vs ペアB形式） |
| S03-L03 | ラベル | 時刻 | 試合終了時刻（HH:MM形式） |
| S03-L04 | ラベル | 試合時間 | 試合にかかった時間（例: "12分"） |
| S03-L05 | ボタン | スコア入力/修正ボタン | "入力" または "修正" ボタン |
| S03-L06 | 状態 | 非表示制御 | スコア入力済み かつ 自分が不参加 の場合のみ非表示可能（個人ごと） |

**注記**: 
- スコア未入力の場合、ボタンは「入力」と表示
- スコア入力済みの場合、ボタンは「修正」と表示
- 自分が参加した試合でスコア未入力の場合は常に表示（非表示不可）
- 試合時間 = 終了時刻 - 開始時刻（分単位で表示）
- **ログ表示/非表示は個人ごとに管理**（Firebaseでユーザーごとに保存）

#### 画面レイアウト
```
┌─────────────────────────┐
│ ゲーム進行中          ⚙️ │
├─────────────────────────┤
│ ■ コート状況 [−] [+]   │
│ ┌────────┬────────┐     │
│ │コート1 │コート2 │     │
│ │┌──────┐│(空き)  │     │
│ ││ゲーム中││        │     │
│ ││たかし ││        │     │
│ ││ゆうこ ││        │     │
│ ││  vs   ││        │     │
│ ││けんた ││        │     │
│ ││まい   ││        │     │
│ │└──────┘│        │     │
│ │  [終了] │[配置]  │     │
│ └────────┴────────┘     │
│ ┌────────┐              │
│ │コート3 │              │
│ │ひろし  │              │
│ │さき    │              │
│ │  vs    │              │
│ │だいき  │              │
│ │りょう  │              │
│ │[クリア]│              │
│ │[開始]  │              │
│ └────────┘              │
│                         │
│ ■ 待機メンバー (4人)    │
│ ┌─────────────────────┐ │
│ │ かずや(2) 📝未 [休憩]│ │
│ │ ...                  │ │
│ └─────────────────────┘ │
│                         │
│ ■ 休憩メンバー (0人)    │
│ ┌─────────────────────┐ │
│ │ (なし)               │ │
│ └─────────────────────┘ │
│                         │
│ ■ 試合ログ [▲]          │
│ ┌─────────────────────┐ │
│ │#3 たかし・ゆうこ vs  │ │
│ │   けんた・まい       │ │
│ │   14:30 (12分) [修正]│ │
│ ├─────────────────────┤ │
│ │#2 ひろし・さき vs    │ │
│ │   だいき・りょう     │ │
│ │   14:15 (15分) [入力]│ │
│ ├─────────────────────┤ │
│ │#1 ...               │ │
│ └─────────────────────┘ │
│                         │
├─────────────────────────┤
│    [メイン] [設定]      │
└─────────────────────────┘
```

**レイアウト補足**:
- コート状況の見出し横にコート数増減ボタン `[−] [+]`
- コート数に応じてコートカードを動的に表示（1〜3コート）
- 試合ログに試合時間を追加表示（例: "(12分)"）

**レイアウト補足**:
- コート1: ゲーム中状態（半透明オーバーレイ + "ゲーム中" + 終了ボタン）
- コート2: 空き状態（配置ボタンのみ）
- コート3, 4: 配置済み・開始前状態（クリア + 開始ボタン）

#### 操作フロー

1. **コート数変更**:
   - 「+」ボタンをタップ → コート数を1増やす（最大3）
   - 「−」ボタンをタップ → コート数を1減らす（最小1）
   - **減少制御**: 使用中のコート（ready または playing）がある場合、減少ボタンは非表示
   - 空きコートのみの場合のみ減少可能
   - コート番号は常に1から順番（減少時はコート3→2→1の順で削除）
   - コート数が変更されると、グルーピングが自動的に再計算される

2. **配置**:
   - 空きコート下の「配置」ボタンをタップ
   - 待機メンバーから4人を自動選択
   - そのコートに配置 → 状態が「配置済み（開始前）」に変化
   - 「配置」ボタンが「クリア」「開始」ボタンに変化

3. **クリア**:
   - 配置済み（開始前）のコート下の「クリア」ボタンをタップ
   - 4人全員が待機メンバーに戻る
   - コートが空き状態に → 「配置」ボタンのみ表示

4. **ゲーム開始**:
   - 配置済み（開始前）のコート下の「開始」ボタンをタップ
   - コート上に半透明のオーバーレイ + "ゲーム中" 表示
   - 「クリア」「開始」ボタンが「終了」ボタンに変化
   - ゲーム中でもメンバーのメンバー入れ替えは可能

5. **ゲーム終了**:
   - ゲーム中のコート下の「終了」ボタンをタップ
   - 終了時刻を記録
   - 試合ログに追加（スコア未入力状態）
   - コートが空き状態に → 「配置」ボタンのみ表示
   - 4人全員が待機メンバーに戻る

6. **メンバー入れ替え（タップ方式）**:
   - 1回目: 交換したいメンバー（コート内または待機者）をタップ → 背景色が変わり選択状態に
   - 2回目: 交換先のメンバーをタップ → 即座に交換実行、選択状態解除
   - 選択中に同じメンバーを再度タップ → 選択解除
   - 交換可能な組み合わせ:
     - 待機メンバー ↔ コート内メンバー（ゲーム中でも可能）
     - コート内メンバー ↔ コート内メンバー（ゲーム中でも可能）

7. **休憩設定**:
   - 待機者の「休憩」ボタンをタップ → 休憩メンバーへ移動
   - 休憩者の「復帰」ボタンをタップ → 待機メンバーへ移動

8. **スコア入力**:
   - 試合ログの「入力」「修正」ボタンをタップ → S04（スコア入力画面）へ遷移
   - スコア入力はログからのみ実行可能

9. **ログ表示切替**:
   - 「▼」ボタンをタップ → ログリストを展開
   - 「▲」ボタンをタップ → ログリストを折りたたみ
   - ただし、スコア未入力かつ自分が参加した試合は常に表示（非表示不可）

---

### S04: スコア入力画面

#### 目的
試合結果（スコア）を入力・確定する

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S04-01 | ナビゲーションバー | タイトル | "スコア入力" |
| S04-02 | ボタン | キャンセルボタン | "キャンセル"（左上） |
| S04-03 | ラベル | コート番号 | "コート 1" |
| S04-04 | セクション | ペアA表示 | ペアAのメンバー名 |
| S04-05 | セクション | ペアB表示 | ペアBのメンバー名 |
| S04-06 | ラベル | VS表示 | "vs" |
| S04-07 | セクション | 点数ボタングリッド | 0〜30のボタン配置 |
| S04-08 | ラベル | 入力履歴表示 | 入力した点数を表示 |
| S04-09 | ボタン | クリアボタン | "クリア" |
| S04-10 | ボタン | 確定ボタン | "確定" |
| S04-11 | アラート | エラーダイアログ | バリデーションエラー表示 |

#### 画面レイアウト
```
┌─────────────────────────┐
│ キャンセル  スコア入力    │
├─────────────────────────┤
│      コート 1            │
│                         │
│  たかし・ゆうこ          │
│        vs               │
│  けんた・まい            │
│                         │
│ ─────────────────────   │
│                         │
│ 点数を順番にタップ:      │
│                         │
│ [入力履歴: 21 - 15 ]    │
│                         │
│ ┌─────────────────────┐ │
│ │ 0  1  2  3  4  5  6 │ │
│ │ 7  8  9 10 11 12 13 │ │
│ │14 15 16 17 18 19 20 │ │
│ │21 22 23 24 25 26 27 │ │
│ │28 29 30             │ │
│ └─────────────────────┘ │
│                         │
│ [クリア]        [確定]  │
└─────────────────────────┘
```

#### 操作フロー

1. **点数入力**:
   - 0〜30のボタンを順番にタップ
   - 入力履歴に表示（例: "21 - 15"）
   - 2つの点数が入力されたら確定可能

2. **クリア**:
   - 「クリア」ボタンで入力をリセット

3. **確定**:
   - 「確定」ボタンタップ
   - バリデーション実施:
     - 21点制/15点制: 設定点数以上かチェック
     - デュース: 2点差かチェック
   - エラーがあればアラート表示
   - 成功すればS03（メイン画面）へ戻る

---

### S05: 設定画面

#### 目的
アプリ全体の設定を管理

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S05-01 | ナビゲーションバー | タイトル | "設定" |
| S05-02 | ボタン | 完了ボタン | "完了"（右上） |
| S05-03 | セクション | データ設定 | スプレッドシート関連 |
| S05-04 | テキストフィールド | スプレッドシートURL | URL入力欄 |
| S05-05 | ボタン | データ読み込みボタン | "データを読み込む" |
| S05-06 | セクション | ゲーム設定 | 点数設定 |
| S05-07 | セグメントコントロール | 点数設定 | "21点" / "15点" / "フリー" |
| S05-08 | セクション | 参加者管理 | 当日参加者設定 |
| S05-09 | ボタン | 参加者管理ボタン | "参加者を管理" |
| S05-10 | セクション | セッション管理 | 練習のリセット・履歴コピー |
| S05-11 | ボタン | 練習リセットボタン | "練習をリセット" |
| S05-12 | ボタン | 履歴コピーボタン | "履歴をコピー" |
| S05-13 | アラート | リセット確認ダイアログ | 3択（ログ保存/ログ削除/キャンセル） |

#### 画面レイアウト
```
┌─────────────────────────┐
│ 設定                完了 │
├─────────────────────────┤
│                         │
│ ■ データ設定            │
│ ┌─────────────────────┐ │
│ │ スプレッドシートURL   │ │
│ │ [____________]       │ │
│ │ [データを読み込む]    │ │
│ └─────────────────────┘ │
│                         │
│ ■ ゲーム設定            │
│ ┌─────────────────────┐ │
│ │ 点数設定:            │ │
│ │ [21点|15点|フリー]   │ │
│ └─────────────────────┘ │
│                         │
│ ■ 参加者管理            │
│ ┌─────────────────────┐ │
│ │ [参加者を管理 >]     │ │
│ └─────────────────────┘ │
│                         │
│ ■ セッション管理        │
│ ┌─────────────────────┐ │
│ │ [練習をリセット]     │ │
│ │ [履歴をコピー]       │ │
│ └─────────────────────┘ │
│                         │
└─────────────────────────┘
```

**リセット確認ダイアログ**:
```
┌─────────────────────────┐
│ 練習をリセットしますか?  │
│                         │
│ 試合数、待機時間などが   │
│ リセットされます         │
│                         │
│ ┌─────────────────────┐ │
│ │ログを保存してリセット│ │
│ │- 本日のログを保存    │ │
│ │- 後から閲覧可能      │ │
│ └─────────────────────┘ │
│                         │
│ ┌─────────────────────┐ │
│ │ログを削除してリセット│ │
│ │- ログを完全削除      │ │
│ └─────────────────────┘ │
│                         │
│ ┌─────────────────────┐ │
│ │    キャンセル        │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

---

### S07: 参加者管理画面

#### 目的
当日の参加者を初期設定（練習開始前に管理者が実施）

#### 画面要素

| 要素ID | 種類 | 名称 | 説明 |
|--------|------|------|------|
| S07-01 | ナビゲーションバー | タイトル | "参加者管理" |
| S07-02 | ボタン | 戻るボタン | "戻る"（左上） |
| S07-03 | ボタン | 完了ボタン | "完了"（右上） |
| S07-04 | セクション | 参加者一覧 | 登録済み参加者の一覧 |
| S07-05 | グリッド | メンバーグリッド | 横並び3列程度で折り返し（名前の長さで調整） |
| S07-06 | セル | メンバーセル（複数） | 各メンバーの表示セル |
| S07-07 | ボタン | メンバー名ボタン | メンバー名を表示するボタン |
| S07-08 | ボタン | 削除ボタン | "✕" ボタン（メンバー名ボタンのすぐ隣） |
| S07-09 | セクション | メンバー追加 | 新しいメンバーを1人追加 |
| S07-10 | テキストフィールド | 名前入力欄 | 新しいメンバーの名前入力 |
| S07-11 | ボタン | 追加ボタン | "追加" ボタン |

#### 画面レイアウト
```
┌─────────────────────────┐
│ 戻る  参加者管理     完了│
├─────────────────────────┤
│                         │
│ ■ 参加者一覧 (10人)     │
│ ┌─────────────────────┐ │
│ │[たかし✕][ゆうこ✕]   │ │
│ │[けんた✕]             │ │
│ │                      │ │
│ │[まい✕][ひろし✕]     │ │
│ │[さき✕]               │ │
│ │                      │ │
│ │[だいき✕][りょう✕]   │ │
│ │[なお✕]               │ │
│ │                      │ │
│ │[まさる✕]             │ │
│ └─────────────────────┘ │
│                         │
│ ■ メンバー追加          │
│ ┌─────────────────────┐ │
│ │ 名前:               │ │
│ │ [___________] [追加]│ │
│ └─────────────────────┘ │
│                         │
└─────────────────────────┘
```

**レイアウト補足**:
- メンバーは横並び、基本的に3人程度で折り返し
- 名前が長い場合は早めに折り返し（レスポンシブ）
- 削除ボタン（✕）はメンバー名ボタンのすぐ右側に配置
- 例: `[たかし✕]` のように一体化したボタンセット

#### 操作フロー

1. **メンバー表示**:
   - 登録済みのメンバーがボタン形式でグリッド表示
   - 横並び、基本的に3人程度で折り返し
   - 名前が長い場合は自動で早めに折り返し
   - 各メンバーボタンのすぐ隣に削除ボタン（✕）を配置

2. **メンバー削除**:
   - 削除ボタン（✕）をタップ
   - 確認ダイアログ表示（任意）
   - メンバーをリストから削除

3. **メンバー追加**:
   - 名前入力欄に新しいメンバーの名前を入力
   - 「追加」ボタンをタップ
   - グリッドの末尾に追加
   - 入力欄をクリア

4. **完了**:
   - 「完了」ボタンでS05（設定画面）へ戻る

---

## 4. 画面遷移の特記事項

### 4.1 タブバーによる遷移
メイン画面（S03）では、以下の2つのタブが常に表示:
- **メイン**: S03（現在の画面）
- **設定**: S05へ遷移

### 4.2 モーダル遷移
以下の画面はモーダル表示:
- S04（スコア入力画面）
- S07（参加者管理画面）

### 4.3 初回起動フロー
```
S01（初回起動・参加者入力含む） → S02（参加者選択） → S03（メイン）
```

### 4.4 通常の起動フロー（2回目以降）
```
S02（参加者選択） → S03（メイン）
```

**注記**: 
- 初回起動時、S01で当日の参加者を入力
- 2回目以降は前回の参加者リストが保持され、S02から開始
- 参加者リストの変更はS05（設定）→S07（参加者管理）から可能

---

## 5. UI/UXの重要ポイント

### 5.1 メイン画面の操作性
- **コート表示**: 横並びのカードレイアウトで複数コートを一覧表示
  - 2列グリッド表示（コート1-2 / コート3-4）
  - 空きコートは薄いグレーで表示
  - 各コート下部に状態に応じたボタンを配置:
    - 空き: 「配置」ボタン
    - 配置済み（開始前）: 「クリア」「開始」ボタン
    - ゲーム中: 「終了」ボタン + 半透明オーバーレイ
- **ゲーム状態管理**:
  - 配置 → 開始 → 終了の明確なフロー
  - ゲーム中は半透明オーバーレイで視覚的に区別
  - ゲーム中でもメンバー交換可能（柔軟な運用）
- **タップ交換**: メンバーを2回タップで直感的に交換
  - 1回目のタップで選択状態を視覚的に表示（背景色変更）
  - 2回目のタップで即座に交換実行
  - コート間、コート-待機者間の交換が可能
  - ゲーム中のメンバーも交換可能
- **タップ操作**: 休憩/復帰をワンタップで切り替え
- **視認性**: コート状況を一目で把握できるカードデザイン
- **試合ログ**: 最大100件の試合履歴を表示
  - 最新の試合が上に表示
  - 連番、プレイヤー、時刻、入力/修正ボタンを表示
  - ログごとにスコア入力/修正ボタン配置
  - 折りたたみ可能（ただし未入力かつ自分参加の試合は常時表示）

### 5.2 レーティングの取り扱い
- **完全非表示**: レーティングは画面上に一切表示しない
- **心理的安全性**: 参加者がレベル差を気にせず楽しめる環境を提供
- **裏側での活用**: 自動配置アルゴリズムでのみ使用

### 5.3 スコア入力の簡便性
- **大きなボタン**: 0〜30のボタンは指で押しやすいサイズ
- **入力履歴表示**: 入力ミスを防ぐため、常に表示
- **即座にフィードバック**: エラーはリアルタイムで表示

### 5.3 オフライン対応
- **ローカルキャッシュ**: スプレッドシートデータをローカル保存
- **同期インジケーター**: オンライン/オフライン状態を明示

### 5.4 アクセシビリティ
- **文字サイズ**: ニックネームやスコアは大きく表示
- **コントラスト**: 背景と文字のコントラストを確保
- **音声フィードバック**: VoiceOver対応（将来実装）

---

## 6. まとめ

本画面設計書では、バドミントンゲーム練習管理システムの全6画面（履歴画面はメインに統合）について、画面要素・レイアウト・遷移フローを詳細に定義した。特にメイン画面（S03）は試合進行の中核として、コート管理（空き/配置済み/ゲーム中の3状態）・待機者管理・試合ログを統合し、タップベースの直感的な操作性を重視した設計としている。自動配置アルゴリズムは、待機時間・試合数・スコア入力状態・レーティングに基づくグルーピングを組み合わせ、公平かつ効率的な試合進行を実現する。スコア入力画面（S04）は使用頻度が高いため、簡便な入力UIを採用している。

---

**作成日**: 2026年1月28日  
**バージョン**: 1.4
**更新内容**: 
- v1.0: 初版作成
- v1.1: 履歴画面をメイン画面に統合、メンバー入れ替えをタップ方式に変更、試合ログ機能追加
- v1.2: ゲーム状態管理機能追加（空き/配置済み/ゲーム中）、開始・終了・クリアボタン追加、ゲーム中オーバーレイ表示
- v1.3: 配置アルゴリズム詳細化（待機時間優先、スコア未入力ペナルティ、レーティングベースのグルーピング）、スコア未入力状態の視覚表示追加
- v1.4: 試合数管理機能追加（平均試合数基準の係数計算）、試合数表示追加
