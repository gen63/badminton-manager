# バドミントンゲーム練習管理システム - 将来計画と運用

## 目次
- [1. 将来的な拡張機能](#1-将来的な拡張機能)
- [2. 運用上の注意点](#2-運用上の注意点)
- [3. まとめ](#3-まとめ)

---

## 1. 将来的な拡張機能

### 1.1 ログアーカイブ機能

#### 概要
練習リセット時に「ログを保存してリセット」を選択した際、過去のログを保存・閲覧できる機能

#### 実装案
```javascript
// Firestore構造
sessions/{sessionId}/
  └─ archives/{archiveId}/
      ├─ archivedAt: timestamp
      ├─ matches: array
      └─ summary: object
```

#### 画面
- 設定画面に「過去のログ」ボタン追加
- ログ一覧画面で日付ごとに表示
- 各ログの詳細表示・再コピー可能

---

### 1.2 スコア入力承認機能

#### 概要
スコア入力後、対戦相手（4人中の他の誰か）による承認フロー

#### 実装案
```javascript
// matches構造に追加
{
  score: "21-15",
  enteredBy: "uid1",  // 入力者
  approvedBy: ["uid2", "uid3"],  // 承認者（2人以上で承認完了）
  status: "pending" | "approved"
}
```

#### UI
- スコア入力後、「承認待ち」バッジ表示
- 他のメンバーに通知
- 2人以上が承認で確定

---

### 1.3 統計・分析機能

#### 個人成績
- **勝率**: 全試合中の勝利数 / 総試合数
- **対戦相手別成績**: 特定の相手との勝敗記録
- **ペア別成績**: 誰とペアを組んだ時の勝率
- **時系列グラフ**: 勝率の推移

#### チーム全体
- **試合数分布**: メンバーごとの試合数の公平性
- **待機時間分析**: 待機時間のバラつき
- **コート稼働率**: 各コートの使用率

#### 実装案
```javascript
// 新規コレクション
sessions/{sessionId}/
  └─ statistics/
      ├─ playerStats/{playerId}/
      │   ├─ totalMatches: number
      │   ├─ wins: number
      │   ├─ winRate: number
      │   └─ opponentStats: map
      │
      └─ teamStats/
          ├─ averageMatchCount: number
          ├─ courtUtilization: map
          └─ fairnessScore: number
```

---

### 1.4 通知機能の拡張

#### 次の試合呼び出し通知
- 配置ボタン押下時、選ばれた4人に通知
- 「あなたが次の試合に選ばれました」

#### 休憩時間リマインダー
- 休憩開始から10分後に通知
- 「そろそろ復帰しませんか?」

---

### 1.5 複数デバイス同期

#### 概要
同じ人が複数デバイスからログインできる機能

#### 実装案
- FCMトークンを配列で管理
- Anonymous Authからメールアドレス認証に移行
- デバイス一覧表示・管理画面

```javascript
// players構造変更
{
  fcmTokens: [
    { token: "...", deviceName: "iPhone 13", lastUsed: timestamp },
    { token: "...", deviceName: "iPad", lastUsed: timestamp }
  ]
}
```

---

### 1.6 カスタム通知音

#### 概要
ユーザーが好きな通知音をアップロード・設定できる機能

#### 実装案
- Firebase Storageに音声ファイル保存
- 設定画面で音声選択・プレビュー
- デフォルト音も複数用意

---

### 1.7 ペア固定モード

#### 概要
特定のペアを固定して練習する機能（シングルス練習など）

#### 実装案
- 設定画面で「ペア固定モード」ON/OFF
- ペア編成を手動で設定
- 自動配置でもペアは変更されない

---

### 1.8 レーティング自動更新

#### 概要
試合結果からレーティングを自動計算・更新

#### 実装案
- Eloレーティングシステムを実装
- 勝敗結果から自動計算
- スプレッドシートへの自動反映（Google Sheets API）

```javascript
function updateRating(winner, loser) {
  const K = 32;  // K-factor
  const expectedW = 1 / (1 + Math.pow(10, (loser.rating - winner.rating) / 400));
  const expectedL = 1 - expectedW;
  
  winner.rating += K * (1 - expectedW);
  loser.rating += K * (0 - expectedL);
}
```

---

## 2. 運用上の注意点

### 2.1 参加者の自律性

#### 休憩設定
- 誰でも誰の休憩設定も変更可能
- 周囲のメンバーが協力して管理
- トイレ、水分補給、怪我などに柔軟対応

#### スコア入力
- 誰でも入力・修正可能
- 試合参加者が責任を持って実施
- 承認機能は将来実装（現在は信頼ベース）

### 2.2 柔軟な対応

#### ペア編成
- 自動配置はあくまで提案
- 現場で柔軟に調整可能（メンバー入れ替え機能）
- レーティングは目安であり絶対ではない

#### システムの位置づけ
- あくまで補助ツール
- 現場の判断を優先
- 楽しむことが最優先

### 2.3 データ管理

#### セッション有効期限
- 48時間アクセスなしで自動削除
- 練習後は履歴コピーでバックアップ推奨
- 長期保存が必要な場合は外部保存

#### プライバシー
- レーティングは画面に表示されない
- 試合ログは全員が閲覧可能
- 個人ごとの非表示設定可能

### 2.4 トラブルシューティング

#### ネットワークエラー
1. WiFi/4G接続を確認
2. ブラウザを再読み込み
3. それでも解決しない場合、セッション作成からやり直し

#### データ不整合
1. ブラウザを再読み込み
2. 他のメンバーの画面と比較
3. 最悪の場合、練習リセット

#### 通知が届かない
1. ブラウザの通知許可を確認
2. FCMトークンの再取得（再ログイン）
3. デバイスの通知設定を確認

---

## 3. まとめ

### 3.1 プロジェクトの目的

本システムは、バドミントンのゲーム練習における煩雑な管理業務を効率化し、参加者全員が円滑に楽しく練習できる環境を提供することを目的とする。

### 3.2 設計思想

#### 公平性
- レーティングに基づく自動配置
- 待機時間・試合数の均等化
- グルーピングによる実力バランス

#### 柔軟性
- 手動調整機能（メンバー入れ替え）
- 休憩機能
- 現場判断の尊重

#### 利便性
- リアルタイム同期
- プッシュ通知
- 履歴コピー機能

#### シンプルさ
- 直感的なUI
- 最小限の操作
- 管理者権限なし（全員が平等）

### 3.3 今後の展開

- v1.0: 基本機能（配置、進行、記録）
- v1.5: 通知機能、履歴コピー
- v2.0: ログアーカイブ、承認機能
- v2.5: 統計・分析機能
- v3.0: レーティング自動更新

### 3.4 成功の指標

- 参加者の満足度向上
- 試合数のバラつき削減（標準偏差 < 1回）
- 待機時間の短縮
- スコア入力率の向上（> 80%）

---

## 関連ドキュメント

- [01_overview.md](./01_overview.md) - 概要
- [02_functional_requirements.md](./02_functional_requirements.md) - 機能要件
- [03_session_and_notification.md](./03_session_and_notification.md) - セッション・通知
- [04_technical_spec.md](./04_technical_spec.md) - 技術仕様
- [05_screen_design.md](./05_screen_design.md) - 画面設計

---

**作成日**: 2026/01/29  
**最終更新**: 2026/01/29  
**バージョン**: 1.0
