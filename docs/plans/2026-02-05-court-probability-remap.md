# 3コート配置確率の変更

## 背景

3コート運用時、プレイヤーをレーティング順に upper / middle / lower の3グループに分け、
各グループがどのコートに配置されるかを確率で制御している。

現在の確率設定ではコートの実態と合わない部分があるため、配置先を変更する。

## 変更内容

### 配置確率 (`COURT_PROBABILITIES_3`)

**現在:**

```
           C1     C2     C3
upper:   [0.50,  0.50,  0.00]   ← C1,C2のみ（C3には入らない）
middle:  [0.25,  0.50,  0.25]
lower:   [0.00,  0.50,  0.50]   ← C2,C3のみ（C1には入らない）
```

**変更後:**

```
           C1     C2     C3
upper:   [0.00,  0.50,  0.50]   ← C2,C3のみ（C1には入らない）
middle:  [0.25,  0.50,  0.25]   ← 変更なし
lower:   [0.50,  0.00,  0.50]   ← C1,C3のみ（C2には入らない）
```

### 各コートの構成

| コート | 配置されるグループ |
|--------|-------------------|
| C1     | middle, lower     |
| C2     | upper, middle     |
| C3     | upper, middle, lower（全グループ） |

---

## 連勝/連敗によるランク入れ替え

### ルール

- **二連勝** → 一つ上のランクのメンバーと交代（昇格）
- **二連敗** → 一つ下のランクのメンバーと交代（降格）

### 例

```
[upper]  A, B, C
[middle] D, E, F
[lower]  G, H, I

D が二連勝 → D は upper へ、upper の誰か1人が middle へ
E が二連敗 → E は lower へ、lower の誰か1人が middle へ
```

### 確認事項（要決定）

1. **交代相手の選び方**: 上のランクの「誰と」入れ替えるか？
   - 案A: 上のランクで最も連敗が多い人（成績が悪い人）
   - 案B: 上のランクで最もレーティングが低い人（境界の人）
   - 案C: ランダム
2. **上限/下限**: upper で二連勝、lower で二連敗の場合はどうするか？
   - 案A: 何も起きない（既に最上位/最下位）
   - 案B: 連勝カウントをリセットするだけ
3. **カウントのリセット**: 入れ替え発生後、連勝/連敗カウントはリセットされるか？
4. **連勝/連敗の定義**: 直近2試合の結果？それとも途中で休憩を挟んだらリセット？

---

## 変更箇所（まとめ）

### 1. 配置確率の変更
- `src/lib/algorithm.ts` 8-11行目: `COURT_PROBABILITIES_3` の値のみ変更
- middle の確率は変更なし

### 2. ランク入れ替えロジック（新規）
- 連勝/連敗のトラッキング（matchHistory から算出 or プレイヤーに状態追加）
- `groupPlayers3Court()` の結果を連勝/連敗で動的に調整
- 入れ替え対象の選定ロジック
