# 🏸 バドミントン練習管理システム

週3回のバドミントン練習で、約25人の参加者を1〜3面のコートに効率的に配置・管理するWebアプリケーションです。

## 🚀 デモ

**https://gen63.github.io/badminton-manager/**

## ✨ 主な機能

### Phase 0（現在のバージョン）

#### セッション管理
- ✅ **セッション作成** - コート数（1〜3、デフォルト3）、点数（11/15/21）を設定
- ✅ **練習開始日時** - 「次へ」押下時の現在時刻がデフォルト、設定画面で変更可能
- ✅ **参加者管理** - 複数行一括入力対応（改行区切り、レーティング付き入力可）
- ✅ **チェックイン** - 全員休憩で開始、到着した人を待機に切り替え
- ✅ **LocalStorage保存** - ブラウザ内でデータ永続化

#### コート配置
- ✅ **自動配置機能**
  - 空のコートのみに配置（既存配置を保護）
  - プレイ回数、ペア履歴、対戦履歴を考慮した最適配置
  - 配置不可時はボタンを無効化（エラーメッセージなし）
  - 未配置コートには「未配置」テキスト表示（配置済みと同じ高さを確保）
- ✅ **メンバー交換機能**
  - コート内 ↔ コート内
  - コート内 ↔ 待機中
  - 休憩中のメンバーも交換可能
  - 選択中プレイヤーに「✕」ボタン表示
  - もう一度タップで選択解除
- ✅ **メンバー追加** - メイン画面から1人ずつ追加可能

#### ゲーム進行
- ✅ **試合管理**
  - 試合開始・終了（開始ボタンが左、クリアボタンが右）
  - リアルタイムタイマー表示（コート番号の右側に表示）
  - 試合終了後は自動的にプレイヤーが待機に戻る
- ✅ **スコア入力**
  - 専用画面で0〜30点を選択
  - 設定点数付近（±2）をハイライト表示
  - 入力画面でメンバー交換可能
  - 遷移元に応じて戻り先を自動判定（メイン/履歴）
  - バリデーション機能
    - 同点禁止
    - どちらかは設定点数以上である必要あり
    - デュース時（両方設定点数以上）は2点差必須
- ✅ **スコア未入力の試合** - メイン画面に最新2件を表示

#### 履歴・統計
- ✅ **試合履歴**
  - 連番付きで全試合を表示（名前 vs 名前 / 時刻 経過時間 スコア）
  - 各試合に編集ボタン（✏️）と削除ボタン（🗑️）を常時表示
  - 削除は確認なしで即実行
- ✅ **履歴コピー**
  - 簡潔なフォーマット（日付 + 連番 + 名前 + スコア）
  - 統計情報なし、時刻なし、勝者なし

#### UI/UX
- ✅ **グレーベースのデザイン** - 背景薄グレー、カード白
- ✅ **コート番号** - 丸囲み数字（①②③）で表示
- ✅ **選択状態の明確化** - チェックマーク、リング、拡大表示
- ✅ **ピル型ボタン** - 角丸のモダンなデザイン
- ✅ **控えめなヘッダー** - タイトルサイズを統一
- ✅ **休憩中表示** - 0人の場合も「休憩中 (0人)」と表示
- ✅ **レスポンシブ** - 3コート時も横スクロールなしで表示

### 配置アルゴリズム v2

#### グルーピング
- **3コート運用**: 参加者を3等分（上位/中位/下位）、端数は中位へ
- **2コート運用**: 参加者を2等分（上位/下位）、端数は下位へ
- レーティング未設定者はデフォルト1500

#### 配置確率（3コート）
| グループ | コート1 | コート2 | コート3 |
|----------|---------|---------|---------|
| 上位G | 50% | 50% | 0% |
| 中位G | 25% | 50% | 25% |
| 下位G | 0% | 50% | 50% |

#### 配置確率（2コート）
| グループ | コート1 | コート2 |
|----------|---------|---------|
| 上位G | 70% | 30% |
| 下位G | 30% | 70% |

#### 優先度（滞在時間ベース）
```
滞在開始 = max(練習開始日時, 休憩解除時刻)
優先スコア = 試合回数 / max(滞在時間(分), 5)
```
- スコアが低い人を優先
- まだ試合してない人は最優先（1回保証）
- 遅刻者も途中参加者も公平に扱える

#### 制約
- 直近3試合で4人中3人同じ → 回避
- 上位3人+下位1人 または 下位3人+上位1人 → 回避
- ペア履歴・対戦履歴を考慮

#### チェックイン機能
- セッション開始時、全員「休憩」で登録
- 到着した人を「待機」に切り替え → その時刻を記録
- 練習開始日時より前に切り替えても、練習開始日時が採用される

## 🛠️ 技術スタック

- **フロントエンド**
  - React 19 + TypeScript
  - Vite（ビルドツール）
  - Tailwind CSS 4（スタイリング）
  - Zustand（状態管理）
  - React Router v7（ルーティング）

- **データ保存**
  - LocalStorage（Phase 0）
  - Firebase Firestore（Phase 1予定）

- **デプロイ**
  - GitHub Pages

## 📦 開発環境のセットアップ

### 必要なもの

- Node.js 18以上
- npm

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/gen63/badminton-manager.git
cd badminton-manager

# 依存パッケージをインストール
npm install

# 開発サーバーを起動
npm run dev
```

開発サーバーが起動したら、ブラウザで `http://localhost:5173/badminton-manager/` にアクセス。

### ビルド

```bash
# 本番用ビルド
npm run build

# ビルドしたファイルをプレビュー
npm run preview
```

### デプロイ

```bash
# GitHub Pagesにデプロイ
npm run deploy
```

## 📱 使い方

### 1. セッション作成

- コート数（1〜3）を選択（デフォルト: 3）
- 目標点数（11/15/21）を選択
- 練習参加メンバーを入力（1行に1人、任意）
- 選択中の項目にはチェックマーク（✓）が表示

### 2. メイン画面

#### 一括配置
- ヘッダーの「一括配置」ボタンで空のコート全てに一度に配置
- 配置不可時はボタンが無効化される

#### メンバー追加
- 参加者一覧の入力欄からメンバーを1人ずつ追加可能
- Enterキーまたは「+」ボタンで追加

#### メンバー交換
1. プレイヤー名をタップして選択（青色に変化）
2. 交換したい相手をタップ
3. 選択解除：もう一度タップ or 「✕」ボタン
4. 休憩中のメンバーも交換可能

#### ゲーム進行
- **開始** - 「開始」ボタンで試合開始（タイマーがコート番号横に表示）
- **終了** - 「終了」ボタンで試合終了（メンバーは自動的に待機に戻る）

#### スコア入力
- メイン画面の「スコア未入力の試合」から「入力」ボタンをタップ
- 0〜30点をタップして順番に入力
- 確定すると元の画面に戻る

#### 休憩設定
- 待機中のメンバーにあるコーヒーアイコンをタップ
- 休憩中は配置対象外になる

### 3. 履歴画面

- 連番付きで全試合を表示
- **編集ボタン（✏️）** - スコアを編集
- **削除ボタン（🗑️）** - 試合を削除（確認なし）
- **コピーボタン** - 履歴をクリップボードにコピー
  - フォーマット：日付 + 連番 + 名前 + スコア

### 4. 設定画面

- コート数・点数の変更
- 参加者の管理
- セッションのリセット（確認ダイアログ付き）

## 🗂️ プロジェクト構造

```
badminton-manager/
├── src/
│   ├── components/
│   │   ├── CourtCard.tsx           # コートカード（タイマー付き）
│   │   ├── EmptyState.tsx          # 空状態表示
│   │   └── Toast.tsx               # トースト通知（エラーのみ）
│   ├── hooks/
│   │   ├── useToast.ts             # トースト通知フック
│   │   └── useGameTimer.ts         # ゲームタイマーフック
│   ├── lib/
│   │   ├── algorithm.ts            # 配置アルゴリズム
│   │   └── utils.ts                # ユーティリティ関数
│   ├── pages/
│   │   ├── SessionCreate.tsx       # セッション作成
│   │   ├── MainPage.tsx            # メイン画面
│   │   ├── ScoreInputPage.tsx      # スコア入力
│   │   ├── HistoryPage.tsx         # 履歴・編集
│   │   └── SettingsPage.tsx        # 設定
│   ├── stores/
│   │   ├── sessionStore.ts         # セッション状態管理
│   │   ├── playerStore.ts          # プレイヤー状態管理
│   │   └── gameStore.ts            # ゲーム進行管理
│   └── types/
│       ├── player.ts               # Player型定義
│       ├── court.ts                # Court型定義
│       ├── match.ts                # Match型定義
│       └── session.ts              # Session型定義
├── doc/                            # 仕様書
└── public/
    ├── favicon.svg                 # カスタムアイコン
    └── manifest.json               # PWA設定
```

## 📋 Phase 0 実装機能

### コア機能
- ✅ セッション作成・管理
- ✅ 参加者管理（複数行入力 + メイン画面から追加）
- ✅ 自動配置（空のコートのみ）
- ✅ メンバー交換（待機中・休憩中含む）
- ✅ ゲーム進行管理
- ✅ スコア入力（専用画面）
- ✅ 試合履歴・編集・削除
- ✅ 履歴コピー（簡潔フォーマット）

### UI/UX改善
- ✅ グレーベースのモダンデザイン
- ✅ 丸囲み数字のコート番号
- ✅ ピル型ボタン
- ✅ 選択状態の明確化（チェックマーク・リング・拡大）
- ✅ 控えめなヘッダータイトル
- ✅ 履歴の編集・削除ボタン常時表示
- ✅ LocalStorage保存
- ✅ GitHub Pagesデプロイ

### PWA対応（完全版）
- ✅ Service Worker（オフライン対応）
- ✅ 複数サイズアイコン（192x192, 512x512, Apple Touch Icon）
- ✅ スプラッシュスクリーン（iOS/Android自動対応）
- ✅ ホーム画面に追加（manifest対応）
- ✅ アップデート通知

## 🔜 Phase 1 予定

- 🔲 Firebase Firestore連携
- 🔲 リアルタイム同期
- 🔲 セッション共有（URL）
- 🔲 プッシュ通知

## 🤝 貢献

バグ報告や機能提案は、GitHubのIssuesでお願いします。

## 📄 ライセンス

MIT License

## 👤 作成者

Gen (@genzwift)

---

**開発状況**: Phase 0 完了 🎉  
**最終更新**: 2026-01-31
